from Shared.Infrastructure.Postgres import PostgresConnection
from Shared.Domain.Port import Port
from typing import List
from Shared.Domain.PortRepositoryInterface import PortRepositoryInterface


class PortRepository(PortRepositoryInterface):
    database_conector: PostgresConnection

    def __init__(self, database_conector: PostgresConnection):
        self.database_conector = database_conector

    def get_ports(self, domain: str) -> List[Port]:
        ports = self.database_conector.query_all(
            "SELECT ip_address, port_number, service_name, product, version FROM open_ports;")
        ports = [Port(row[0], row[1], row[2], row[3], row[4]) for row in ports]
        return ports
